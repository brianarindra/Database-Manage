# Kamailio Configuration - Generated by Ansible

#### Database configuration via PgBouncer / PostgreSQL
{% if db_type == "postgres" %}
modparam("db_postgres", "db_url", "postgres://{{ db_user }}:{{ db_password }}@{{ db_host }}:{{ db_port }}/{{ db_name }}")
{% elif db_type == "mysql" %}
modparam("db_mysql", "db_url", "mysql://{{ db_user }}:{{ db_password }}@{{ db_host }}:{{ db_port }}/{{ db_name }}")
{% endif %}

modparam("usrloc", "db_mode", {{ usrloc_db_mode | default(2) }})
modparam("auth_db", "db_url", "{% if db_type == 'mysql' %}mysql://{{ db_user }}:{{ db_password }}@{{ db_host }}:{{ db_port }}/{{ db_name }}{% else %}postgres://{{ db_user }}:{{ db_password }}@{{ db_host }}:{{ db_port }}/{{ db_name }}{% endif %}")

#### Logging configuration
log_level = {{ log_level | default(3) }}
modparam("acc", "log_flag", {{ acc_log_flag | default(1) }})
modparam("acc", "db_flag", {{ acc_db_flag | default(1) }})

#### Security / Production tweaks
# Enable TLS if configured
{% if tls_enabled %}
modparam("tls", "config", "{{ tls_config_file }}")
{% endif %}

# Anti-flood / DoS protection
{% if anti_flood_enabled %}
modparam("pv", "rate_limit", {{ pv_rate_limit | default(50) }})
{% endif %}

# Other production security options can be added here
